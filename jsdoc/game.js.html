<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: game.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: game.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>//

/* eslint-disable no-plusplus, no-continue */

/**
 * Game module, iterates over all options.
 * &lt;pre>
 * 1. Load modules
 * 2. Start looking for solutions.
 * &lt;/pre>
 * @class Game
 * @requires fs
 * @requires Board
 */

const fs = require('fs');

const Board = require('./board.js');

const { VICTORIES_DIR } = process.env;

class Game {
	constructor(board) {
		this.board = board;
		this.moves = [];
		this.victories = 0;
		this.from = { row: 0, column: 0, type: 0 };
	}

	isVictory() {
		if (this.moves.length &lt; 31) {
			return false;
		}
		if (!this.board.isOccupied(3, 3)) {
			return false;
		}
		return true;
	}

	isGameOver() {
		if (this.moves.length &lt;= 0) {
			if (this.from.row === 6 &amp;&amp; this.from.column === 4 &amp;&amp; this.from.type === 4) {
				console.log('Game is over');
				return true;
			}
		}
		return false;
	}

	writeVictory() {
		fs.writeFileSync(`${VICTORIES_DIR}/${this.victories}.txt`, JSON.stringify(this.moves));
	}

	/* eslint no-constant-condition: ["error", { "checkLoops": false }] */

	start() {
		console.log(`Started at ${new Date().getTime()}`);
		while (true) {
			const move = this.nextMove();
			this.handleNextMove(move);
			if (this.isVictory()) {
				this.handleVictory(true);
			}
			if (this.isGameOver()) {
				break;
			}
		}
		console.log(`Ended at ${new Date().getTime()}`);
	}

	handleVictory(save) {
		this.victories++;
		console.log(`*** Victory ${this.victories} has been found at ${new Date().getTime()} ***`);
		if (save) {
			this.writeVictory();
		}
		this.handleNextMove({ status: 'None' });
	}

	nextMove() {
		for (let { row } = this.from; row &lt; 7; row++) {
			for (let { column } = this.from; column &lt; 7; column++) {
				if (!Board.isLegal(row, column)) {
					continue;
				}
				let startType = 1;
				if (row === this.from.row &amp;&amp; column === this.from.column) {
					startType = this.from.type + 1;
				}
				const move = this.board.findMove(row, column, startType);
				if (move.status === 'OK') {
					return move;
				}
			}
		}
		return { status: 'None' };
	}

	handleNextMove(move) {
		if (move.status === 'OK') {
			if (this.moves.length &lt;= 0) {
				console.log(`--- First Move ${JSON.stringify(move)} at ${new Date().getTime()}`);
			}
			this.board.makeMove(move);
			this.moves.push(move);
			this.from = { row: 0, column: 0, type: 0 };
		} else if (move.status === 'None') {
			const lastMove = this.moves.pop();
			this.board.deleteMove(lastMove);
			this.from = { row: lastMove.from.row, column: lastMove.from.column, type: lastMove.type };
		} else {
			throw Error(`Exception in start(); move ${move} is invalid status`);
		}
	}
}

module.exports = Game;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Main.html">Main</a></li></ul><h3>Classes</h3><ul><li><a href="Board.html">Board</a></li><li><a href="Game.html">Game</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
